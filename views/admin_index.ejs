<%- include('includes/admin_header'); -%>


    <!-- ============================================================== -->
    <!-- main wrapper -->
    <!-- ============================================================== -->
    <div class="dashboard-main-wrapper">
        <!-- ============================================================== -->
        <!-- navbar -->
        <!-- ============================================================== -->
  
        <!-- ============================================================== -->
        <!-- end navbar -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <%- include('includes/left_nav'); -%>
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- wrapper  -->
        <!-- ============================================================== -->
        <div class="dashboard-wrapper">
            <div class="dashboard-ecommerce">
                <div class="container-fluid dashboard-content ">
                    <!-- ============================================================== -->
                    <!-- pageheader  -->
                    <!-- ============================================================== -->
                    <div class="row">
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                            <div class="page-header">
                                <h2 class="pageheader-title">E-commerce Dashboard Template </h2>
                                <p class="pageheader-text">Nulla euismod urna eros, sit amet scelerisque torton lectus vel mauris facilisis faucibus at enim quis massa lobortis rutrum.</p>
                                <div class="page-breadcrumb">
                                    <nav aria-label="breadcrumb">
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="#" class="breadcrumb-link">Dashboard</a></li>
                                            <li class="breadcrumb-item active" aria-current="page">E-Commerce Dashboard Template</li>
                                        </ol>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ============================================================== -->
                    <!-- end pageheader  -->
                    <!-- ============================================================== -->
                    <div class="ecommerce-widget">

                        <div class="row">
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="text-muted">Total Revenue</h5>
                                        <div class="metric-value d-inline-block">
                                          <% if (totalRevenue && totalRevenue[0] && totalRevenue[0].total) { %>
                                            <h1 class="mb-1"><%= totalRevenue[0].total %></h1>
                                          <% } else { %>
                                            <h1 class="mb-1">0</h1>
                                          <% } %>
                                          
                                          
                                         
                                        
                                        </div>
                                        <div class="metric-label d-inline-block float-right text-success font-weight-bold">
                                            <span><i class="fa fa-fw fa-arrow-up"></i></span><span>5.86%</span>
                                        </div>
                                    </div>
                                    <div id="sparkline-revenue"></div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="text-muted">Total Users</h5>
                                        <div class="metric-value d-inline-block">
                                            <h1 class="mb-1"><%= userCount %> </h1>
                                        </div>
                                        <div class="metric-label d-inline-block float-right text-success font-weight-bold">
                                            <span><i class="fa fa-fw fa-arrow-up"></i></span><span>5.86%</span>
                                        </div>
                                    </div>
                                    <div id="sparkline-revenue2"></div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="text-muted">Total Orders</h5>
                                        <div class="metric-value d-inline-block">
                                            <h1 class="mb-1"><%= ordersCount %></h1>
                                        </div>
                                        <div class="metric-label d-inline-block float-right text-primary font-weight-bold">
                                            <span>N/A</span>
                                        </div>
                                    </div>
                                    <div id="sparkline-revenue3"></div>
                                </div>
                            </div>
                        
                        </div>
                        <div class="row">
                            <!-- ============================================================== -->
                      
                            <!-- ============================================================== -->

                            <form  class="form-inline" action="/date_filter" method="get">
            
                                <div class="form-group mx-sm-3 mb-2">
                                  <label for="minPrice" class="sr-only">Minimum Price</label>
                                  <input type="date" name="mindate" class="form-control" id="minPrice" placeholder="min Price">
                                </div>
                                <div class="form-group mx-sm-3 mb-2">
                                  <label for="minPrice" class="sr-only">Maximum Price</label>
                                  <input type="date" name="maxdate" class="form-control" id="maxPrice" placeholder="min Price">
                                </div>
                                <button type="submit" class="btn btn-primary mb-2">Filter </button>
                              </form>           <!-- recent orders  -->
                            <!-- ============================================================== -->
                            <div class="col-xl-12 col-lg-12 col-md-6 col-sm-12 col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table id="adminTable" class="table table-striped table-bordered" style="width:100%">
                                                <thead>
                                                    <tr>
                                                        <th>No</th>
                                                        <th>Date</th>
                                                        <th>Order Id</th>
                                                        <th>Name</th>
                                                        <th>Price</th>
                                                        <th>Payment</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% ordertable.forEach(function(ordertable, index) { %>
                                                        <tr>
                                                            <td><%= index+1 %></td>
                                                            <td><%= ordertable.createdAt.toLocaleDateString() %></td>
                                                            <td><%= ordertable._id %></td>
                                                            <td>
                                                                <% if (ordertable.user) { %>
                                                                    <%= ordertable.user.name %>
                                                                <% } else { %>
                                                                    No User
                                                                <% } %>
                                                            </td>
                                                            <td><%= ordertable.total %></td>
                                                            <td><%= ordertable.payment_method %></td>
                                                        </tr>
                                                    <% }) %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                           
                            <!-- ============================================================== -->
                            <!-- end recent orders  -->

    
                            <!-- ============================================================== -->
                            <!-- ============================================================== -->
                            <!-- customer acquistion  -->
                            <!-- ============================================================== -->
                          
                            <!-- ============================================================== -->
                            <!-- end customer acquistion  -->
                            <!-- ============================================================== -->
                        </div>
                        

                       
                      
                    </div>
                </div>
            </div>

            <div class="col-sm-12 col-xl-6">
                <div class="bg-light rounded h-100 p-4">
                  <h6 class="mb-4">Pie Chart</h6>
                  <canvas id="myChart2"></canvas>
                </div>
              </div>
            <div class="col-sm-12 col-xl-6">
                <div class="bg-dark rounded h-100 p-4">
                  <h6 class="mb-4">Bar Graph</h6>
                  <canvas id="myChart"></canvas>
                </div>
              </div>
            <!-- ============================================================== -->
            <!-- footer -->
            <!-- ============================================================== -->
           
            <!-- ============================================================== -->
            <!-- end footer -->
            <!-- ============================================================== -->
        </div>
        <!-- ============================================================== -->
        <!-- end wrapper  -->
        <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- end main wrapper  -->
    
    <!-- DataTables Buttons JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      let salesData2 = {
        '2023':  [<%= data.deliveredCounts %>, <%= data.placedCounts %>, <%= data.cancelledCounts %>, <%= data.returnCounts %>]
      };
    
      const ctx2 = document.getElementById('myChart2');
    
      const data = {
        labels: [
          'Orders Delivered',
          'Orders Placed',
          'Orders Returned',
          'Orders Cancelled'
        ],
        datasets: [{
          label: 'Orders Status',
          data: salesData2['2023'],
          backgroundColor: [
            'rgb(255, 99, 132)',
            'rgb(54, 162, 235)',
            'rgb(255, 205, 86)',
            'rgb(75, 192, 192)'
          ],
          hoverOffset: 4
        }]
      };
    
      const config = {
        type: 'pie',
        data: data,
      };
    
      new Chart(ctx2, config);
    </script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    let salesData = {
      <% for (const [month, count] of Object.entries(monthlySales)) { %>
        '<%= month %>': <%= count %>,
      <% } %>
    }
 console.log(salesData);
    const ctx = document.getElementById('myChart');
    let myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
        datasets: [{
          label: 'Number of sales',
          data: Object.values(salesData),
          borderWidth: 1
        }
    ]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            ticks: {
              stepSize: 20
            }
          }
        }
      }
    });
  
   
  </script>
  <script>
    function datefilter() {
      

      
    }
  </script>
    <!-- ============================================================== -->
    <!-- Optional JavaScript -->
    <%- include('includes/admin_footer'); -%>